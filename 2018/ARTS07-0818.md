# ARTS07-20180818

## Algorithm

## Review

## Tip

### Maven Profile

开发环境下仅需要`spring-boot-maven-plugin`和`maven-compiler-plugin`这两个插件，

测试环境和生产环境需要多配置一个`dockerfile-maven-plugin`用于构建docker镜像，

且测试环境和生产环境的docker镜像仓库、docker镜像tag都不同，如果开发环境也配置了这个插件，

那么本地进行`mvn install`的时候，则须依赖本地的docker环境，因为会默认执行executions中的docker命令，

这就比较麻烦了，使用Maven Profile可以完美解决这个问题。


公共配置，即开发环境下的配置
```xml
<build>
  <plugins>
      <plugin>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-maven-plugin</artifactId>
          <configuration>
              <executable>true</executable>
          </configuration>
          <executions>
              <execution>
                  <goals>
                      <goal>repackage</goal>
                  </goals>
              </execution>
          </executions>
      </plugin>
      <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-compiler-plugin</artifactId>
          <configuration>
              <source>8</source>
              <target>8</target>
          </configuration>
      </plugin>
  </plugins>
</build>
```

为测试环境和生产环境下增加profile配置

```xml
<project>
  <profiles>
    <profile>
        <id>prod</id>
        <build>
            <plugins>
                v
            </plugins>
        </build>
    </profile>
    <profile>
        <id>test</id>
        <build>
            <plugins>
                <plugin>
                    <groupId>com.spotify</groupId>
                    <artifactId>dockerfile-maven-plugin</artifactId>
                    <version>1.4.3</version>
                    <executions>
                        <execution>
                            <id>default</id>
                            <phase>install</phase>
                            <goals>
                                <goal>build</goal>
                            </goals>
                        </execution>
                    </executions>
                    <configuration>
                        <repository>120.79.164.255:9091/yuntu-eureka-server</repository>
                        <tag>test</tag>
                        <useMavenSettingsForAuth>true</useMavenSettingsForAuth>
                        <buildArgs>
                            <JAR_FILE>target/${project.build.finalName}.jar</JAR_FILE>
                        </buildArgs>
                    </configuration>
                </plugin>
            </plugins>
        </build>
    </profile>
  </profiles>
</project>
```

指定 profile 打包命令

```
mvn clean install -P test
```

## Share
